import{I as x,a as w}from"./ImageViewer-890973b9.js";import{_ as N,r as c,a as D,o as k,d as i,e as u,f as g,g as a,w as r,m as h,p as C,E as f,k as q,n as F,F as A,h as B,i as E,j as P,q as S}from"./index-f498da20.js";/* empty css                                                                    */const M={components:{ImageUploader:x,ImageViewer:w},setup(){const _=c({prescriptionName:"",indications:"",usage:"",treatmentCycle:""}),t=c([]),m=c([]),e=c([]),V=D(),y=async()=>{const l=await h.listDrugs({page:1,size:1e3});e.value=l.data.list},p=async()=>{try{const l=new FormData;l.append("prescription",JSON.stringify(_.value)),l.append("drugIds",JSON.stringify(t.value.map(n=>n.id?n.id:n))),m.value.forEach(n=>{l.append("images",n)});const d=await C.addPrescription(l);if(d.data&&d.data.success){f.success(d.data.msg||"新增药方成功");const n=d.data.prescriptionId||d.data.id;n&&V.push({name:"PrescriptionDetail",params:{id:n}})}else f.error(d.data.msg||"新增药方失败")}catch{f.error("新增药方失败")}},s=l=>{m.value=l};return k(()=>{y()}),{prescription:_,selectedDrugs:t,prescriptionImages:m,drugs:e,submitForm:p,handleImageUpload:s}}},J={class:"prescription-add"},O={key:0,style:{"margin-top":"16px"}};function j(_,t,m,e,V,y){const p=i("el-input"),s=i("el-form-item"),l=i("el-option"),d=i("el-select"),n=i("ImageUploader"),b=i("el-button"),v=i("el-form"),I=i("ImageViewer"),U=i("el-card");return u(),g("div",J,[a(U,{class:"form-card"},{default:r(()=>[t[6]||(t[6]=q("h2",{style:{"margin-bottom":"24px"}},"新增药方",-1)),a(v,{onSubmit:F(e.submitForm,["prevent"]),"label-width":"100px",model:e.prescription},{default:r(()=>[a(s,{label:"药方名称",required:""},{default:r(()=>[a(p,{modelValue:e.prescription.prescriptionName,"onUpdate:modelValue":t[0]||(t[0]=o=>e.prescription.prescriptionName=o),placeholder:"请输入药方名称"},null,8,["modelValue"])]),_:1}),a(s,{label:"适应症",required:""},{default:r(()=>[a(p,{type:"textarea",modelValue:e.prescription.indications,"onUpdate:modelValue":t[1]||(t[1]=o=>e.prescription.indications=o),placeholder:"请输入适应症"},null,8,["modelValue"])]),_:1}),a(s,{label:"用法用量",required:""},{default:r(()=>[a(p,{type:"textarea",modelValue:e.prescription.usage,"onUpdate:modelValue":t[2]||(t[2]=o=>e.prescription.usage=o),placeholder:"请输入用法用量"},null,8,["modelValue"])]),_:1}),a(s,{label:"治疗周期",required:""},{default:r(()=>[a(p,{modelValue:e.prescription.treatmentCycle,"onUpdate:modelValue":t[3]||(t[3]=o=>e.prescription.treatmentCycle=o),placeholder:"如 5 天 / 疗程"},null,8,["modelValue"])]),_:1}),a(s,{label:"关联药品"},{default:r(()=>[a(d,{modelValue:e.selectedDrugs,"onUpdate:modelValue":t[4]||(t[4]=o=>e.selectedDrugs=o),multiple:"",filterable:"",placeholder:"请选择关联药品","value-key":"id"},{default:r(()=>[(u(!0),g(A,null,B(e.drugs,o=>(u(),E(l,{key:o.id,label:o.drugName,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"药方图片"},{default:r(()=>[a(n,{onUpload:e.handleImageUpload},null,8,["onUpload"])]),_:1}),a(s,null,{default:r(()=>[a(b,{type:"primary","native-type":"submit"},{default:r(()=>t[5]||(t[5]=[P("新增药方")])),_:1,__:[5]})]),_:1})]),_:1},8,["onSubmit","model"]),e.prescriptionImages.length?(u(),g("div",O,[a(I,{images:e.prescriptionImages},null,8,["images"])])):S("",!0)]),_:1,__:[6]})])}const T=N(M,[["render",j],["__scopeId","data-v-66d37dc2"]]);export{T as default};
