import{I as P,a as E}from"./ImageViewer-890973b9.js";import{_ as q,b as B,a as F,r as d,o as S,d as i,e as m,f as V,k as M,g as a,w as o,n as z,p as w,m as A,E as D,F as I,h as U,i as C,j as x}from"./index-f498da20.js";/* empty css                                                                    */const R={components:{ImageUploader:P,ImageViewer:E},setup(){const g=B(),l=F(),s=d({prescriptionName:"",indications:"",usage:"",treatmentCycle:""}),t=d([]),N=d([]),f=d([]),n=d([]),r=d([]),u=d([]),c=async()=>{const e=g.params.id;if(!e)return;const p=(await w.getPrescription(e)).data;s.value={prescriptionName:p.prescription.prescriptionName,indications:p.prescription.indications,usage:p.prescription.usage,treatmentCycle:p.prescription.treatmentCycle},r.value=p.drugs||[],n.value=p.images||[]},_=async()=>{const e=await A.listDrugs({page:1,size:1e3});u.value=e.data.list},b=async()=>{const e=g.params.id;try{await w.updatePrescription(e,{prescriptionName:s.value.prescriptionName,indications:s.value.indications,usage:s.value.usage,treatmentCycle:s.value.treatmentCycle,drug_ids:t.value,images:n.value}),D.success("更新成功"),l.push({name:"PrescriptionDetail",params:{id:e}})}catch{D.error("更新失败，请重试")}},v=async()=>{g.params.id,t.value.length&&c()},y=e=>{f.value=e};return S(()=>{_(),c()}),{prescription:s,selectedDrugs:t,prescriptionImages:n,drugs:r,drugsNew:u,selectedDrugsNew:N,prescriptionImagesNew:f,submitForm:b,handleImageUpload:y,deleteSelectedDrugs:v}}},j={class:"prescription-edit"};function L(g,l,s,t,N,f){const n=i("el-input"),r=i("el-form-item"),u=i("el-option"),c=i("el-select"),_=i("el-button"),b=i("ImageViewer"),v=i("ImageUploader"),y=i("el-form");return m(),V("div",j,[l[8]||(l[8]=M("h2",null,"Edit Prescription",-1)),a(y,{onSubmit:z(t.submitForm,["prevent"]),"label-width":"120px",model:t.prescription},{default:o(()=>[a(r,{label:"药方名称"},{default:o(()=>[a(n,{modelValue:t.prescription.prescriptionName,"onUpdate:modelValue":l[0]||(l[0]=e=>t.prescription.prescriptionName=e),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"适应症"},{default:o(()=>[a(n,{type:"textarea",modelValue:t.prescription.indications,"onUpdate:modelValue":l[1]||(l[1]=e=>t.prescription.indications=e),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"用法"},{default:o(()=>[a(n,{type:"textarea",modelValue:t.prescription.usage,"onUpdate:modelValue":l[2]||(l[2]=e=>t.prescription.usage=e),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"疗程"},{default:o(()=>[a(n,{modelValue:t.prescription.treatmentCycle,"onUpdate:modelValue":l[3]||(l[3]=e=>t.prescription.treatmentCycle=e),required:""},null,8,["modelValue"])]),_:1}),a(r,{label:"要移除的药品"},{default:o(()=>[a(c,{modelValue:t.selectedDrugs,"onUpdate:modelValue":l[4]||(l[4]=e=>t.selectedDrugs=e),multiple:"",filterable:"",placeholder:"请选择要移除的药品",style:{width:"100%"}},{default:o(()=>[(m(!0),V(I,null,U(t.drugs,e=>(m(),C(u,{key:e.id,label:e.drugName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(_,{type:"danger",size:"small",style:{"margin-left":"8px","vertical-align":"middle"},onClick:t.deleteSelectedDrugs,disabled:!t.selectedDrugs.length},{default:o(()=>l[6]||(l[6]=[x("删除")])),_:1,__:[6]},8,["onClick","disabled"])]),_:1}),a(r,{label:"关联药品"},{default:o(()=>[a(c,{modelValue:t.selectedDrugsNew,"onUpdate:modelValue":l[5]||(l[5]=e=>t.selectedDrugsNew=e),multiple:"",filterable:"",placeholder:"请选择关联药品","value-key":"id"},{default:o(()=>[(m(!0),V(I,null,U(t.drugsNew,e=>(m(),C(u,{key:e.id,label:e.drugName,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"药方图片预览"},{default:o(()=>[a(b,{images:t.prescriptionImages},null,8,["images"])]),_:1}),a(r,{label:"药方图片"},{default:o(()=>[a(v,{onUpload:t.handleImageUpload},null,8,["onUpload"])]),_:1}),a(r,null,{default:o(()=>[a(_,{type:"primary","native-type":"submit"},{default:o(()=>l[7]||(l[7]=[x("更新药方")])),_:1,__:[7]})]),_:1})]),_:1},8,["onSubmit","model"])])}const H=q(R,[["render",L],["__scopeId","data-v-d7813813"]]);export{H as default};
